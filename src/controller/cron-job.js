const ASN = require('../model/asn_model');
const urlStatus = require('../helper').urlStatusCheck

exports.updateStatusDairy = (req, res) => {
    console.log("cron job started ------------------------------------------");
    ASN.find({}, async (err, datas) => {
        if (res) res.json(datas);
        if (err) {
            throw err;
        } else {
            for (var data of datas) {
                var url_status = await urlStatus(data.url_ip);
                status = url_status == "online" ? "online" : "offline";
                console.log(status);
                if (data.status != status) {
                    await ASN.findOneAndUpdate({ _id: data._id }, { status: status });
                }
            }
            console.log('all status updated done --------------------------------');
        }
    })
}