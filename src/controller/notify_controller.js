

exports.notifyemail = (req, res) => {

  console.log("myemail:", req.body.myemail);


  var request = require('superagent');

  var mailchimpInstance   = 'us20',
    listUniqueId        = '744e5ec7ea',
    mailchimpApiKey     = 'ffe12158bf547ad7f539a77f2a2791dc-us20';


  request
    .post('https://' + mailchimpInstance + '.api.mailchimp.com/3.0/lists/' + listUniqueId + '/members/')
    .set('Content-Type', 'application/json;charset=utf-8')
    .set('Authorization', 'Basic ' + new Buffer('any:' + mailchimpApiKey).toString('base64'))
    .send({
      'email_address': req.body.myemail,
      'status': 'subscribed',      
    })
    .end(function (err, response) {
      console.log(err,response);
      if (err) {
        if (response.body.title === "Member Exists") {
          res.status(203).send({ message: 'member exists' });
        } else
          res.status(203).send({ message: 'submit failed' });
      } else {
        res.status(203).send({ message: 'submit success' });
      }
      // if (response.status < 300 || (response.status === 400 && response.body.title === "Member Exists")) {
      //   console.log(err),
      //       res.status(203).send({ message: 'submit failed' });
      // } else {
      //   console.log(response),
      //       res.status(203).send({ message: 'submit success' })
      // }
    });
}